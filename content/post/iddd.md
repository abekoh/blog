---
title: "『実践ドメイン駆動設計』読んだ"
date: 2020-05-06T16:19:38+09:00
draft: false
categories: [ "tech" ]
tags: [ "DDD" ]
---

お家から出ないように過ごさないといけないGWになってしまったので、このタイミングで積んでしまっていた『実践ドメイン駆動設計』(IDDD本)を一気に読むことにした。

[実践ドメイン駆動設計](https://www.shoeisha.co.jp/book/detail/9784798131610)

DDD勉強するにあたって、原著のエリック・エヴァンスのほう(DDD本)よりこのIDDD本からのほうが掴みやすいかも、という話を聞いて買っておいたもの。


DDDの事前知識としては、次の同人誌で呼んで軽く触れた程度。この本では特に、戦略的設計についてイメージが掴めた。

[わかる！ドメイン駆動設計 ～もちこちゃんの大冒険～](https://techbooster.booth.pm/items/392260)

IDDD本を読んで、結果的にDDD的にするにはどういう手段とるか(戦術的パターン)はなんとなく掴めた一方で、戦略的設計についての理解、実際にやるならなにから始めよう、ってところは掴めてない気がする。

実際にやってみた手順は、Qiitaのこの記事ですごく詳細にまとまってて参考にしたい。

[「実践ドメイン駆動設計」を読んだので、実際にDDDで設計して作ってみた！ - Qiita](https://qiita.com/APPLE4869/items/d210ddc2cb1bfeea9338)

記事中にも挙げられた設計手法の本とか次は読んでみたいかも。(それよりはまず本家DDD本かな)

## 個人的メモ

章ごとにまとめておく。

### 第1章 DDDへの誘い

DDDで解決できること、DDDを導入すべき/控えるべきの基準、といった「DDDはいいぞ」を感じさせる章でした。

エンジニア、ドメインエキスパートが抱えがちな問題は、すごく思い当たる節を感じさせます。

> 新入りの若手開発者「…ほとんど同じようなオブジェクトを大量に使って右から左へデータを渡すだけになるとは思わなかったよ。そんなことをするだけのコードなのに、なぜこんなに複雑なアーキテクチャになっているんだろう？あそこを書き換えたら、いったいどうなるんだろう。…」

(P.4より引用)

単にリレーショナルモデルをオブジェクトに投影しただけのデータモデルを使っている、いわゆる**トランザクションスクリプト**のパターンでありがちなことのようです。そういったドメインモデルをうまく作れていないパターンを**ドメインモデル貧血症**と呼んでいて、それを回避するためにはといった感じで本書で度々登場します。

> ドメインエキスパート「…開発者達は、ソフトウェアの挙動について話すときに、いつも不思議な言いかたをする。Aのことを話そうとすると、「ああ、Bのことですね」みたいな感じだ。彼らと話をするときには、常に辞書を片手に相手の言葉を翻訳しないといけない気がする。…」

(P.5より引用)

翻訳作業に慣れてしまえば一人前、みたいに思ってたこともありますが、それだと人が入れ替わればまたリセットですもんね。**ユビキタス言語**を採用すれば確かにそんな不満はなくなり皆ハッピーになりそうだ、とつくづく感じました。

### 第2章 ドメイン、サブドメイン、境界づけられたコンテキスト

興味を持つべき中核となるドメイン(=**コアドメイン**)は何か、それに関係する補助的なドメイン(=**サブドメイン**)は何か。そしてドメインで使う用語(=ユビキタス言語)が適用される範囲(=**境界づけられたコンテキスト**)はどこまでか。そのあたりの考え方を実例ベースに論じられています。

ドメインとは何か。本書では次のように定義されています。

> 組織が行う事業やそれを取り巻く世界のことだ。事業が試乗を定義して、プロダクトやサービスを販売する。組織にはそれぞれ、自分たちの対象とする領域についてのノウハウや物事の進めかたである。

(P.41より引用)

例の「コラボレーションコンテキストには認証・アクセスの概念は必要ない」から切り離そう。なぜ切り離す必要があるか、どう切り離すかが丁寧に論じられいます。

### 第3章 コンテキストマップ

境界づけられたコンテキスト同士はどのような関係を持つのか考えようという話。

コンテキスト間は9パターンのうちどれかが大体当てはまるとのことだったが、一般的によく使われるのは以下3つらしく、それに沿った場合の解説がされています。

- **公開ホストサービス**
- **公表された言語**
- **腐敗防止層**

各パターンはDDD本のほうに詳しく書かれてそうでした。

### 第4章 アーキテクチャ

DDDと組み合わせると強力なアーキテクチャパターンについて、いくつか取り上げて解説されています。

DDD本ではレイヤ化アーキテクチャを採用しているが、特にそれを採用せねばいけないとい訳ではない。本書ではそれより発展させた**ヘキサゴナルアーキテクチャ**を推しています。

最近だとクリーンアーキテクチャが主流なイメージですが、本質的には同じようなものみたいですね。こちらの記事にまとまっていました。

[[DDD]ドメイン駆動設計で実装を始めるのに一番とっつきやすいアーキテクチャは何か - Qiita](https://qiita.com/little_hand_s/items/ebb4284afeea0e8cc752)

他にもアーキテクチャパターンとして、次のようなものも挙げられています。
- **コマンドクエリ責務分離(CQRS)** … 変更を加えるときは「コマンド」、参照するときは「クエリ」と使い分け、両方の機能を兼ね備えてはいけない。ビュー向けに特化して引っ張ってきたい場合など、分けることでデータへのアクセスがより良い感じになるとか。
- **イベント駆動アーキテクチャ** … イベントの作成や検出、消費そしてイベントへの反応を促すアーキテクチャ。他のコンテキストとやりとりする1つの手段として有用。

### 第5章 エンティティ

他のオブジェクトとの区別が必要なものはエンティティとして定義する。次章で解説される値オブジェクトはそうでなく、この区別がとっつきにくいイメージでした。

### 第6章 値オブジェクト

### 第7章 サービス

### 第8章 ドメインイベント

### 第9章 モジュール

### 第10章 集約

### 第11章 ファクトリ

### 第12章 レポジトリ

### 第13章 境界づけられたコンテキストの統合

### 第14章 アプリケーション